# 文档

## 运行
* 在数据库工具中运行 ``` tagdemo.sql ``` ，会自动将表结构和基础数据导入。路径为：tagdemo -> tag
* 修改源代码 ```TagDemo\target\classes ``` 中的配置文件 ```application.yml```，将数据库连接信息改为自己的数据库
* 用 ```IntelliJ IDEA``` 打开项目，点击运行

## 实体类设计
* ``` id``` ：主键
* ``` hierarchy``` ：层级关系，顶级标签为0，其子标签为1，以此类推
* ``` parentId```：父级标签的主键id
* ``` content```：标签内容
* ``` type```：标签类型 0-普通标签 1-超集/子集标签 2-互斥标签
* ``` del```：删除位标志，未使用


## 功能实现

### 查询兄弟标签和父标签
* 访问路径为 ``` http://localhost:8080/tags/get?method=getParents&tagId=1```
* 接口要求传入标签的 ```id```，当标签不存在返回 ```Tag not found!```
* 如果是顶级标签，直接返回层级为0的所有标签，即兄弟标签，无父标签
* 如果不是顶级标签，则返回父级标签和兄弟标签。
  
### 查询两标签的距离
* 访问路径为 ``` localhost:8080/tags/get?method=getLength&tagId1=7&tagId2=10```
* 接口要求分别传入两个标签的id ``` tagId1``` 和 ``` tagId2```
* 通过id查询到两个标签，只要一个不存在就返回 ```Tag not found! ```
* 若两标签的父级标签id相同，则认为属于兄弟标签，按照既定规则通过 ```switch``` 语句，根据父级标签的 ``` type``` 字段，返回 ```[0,1,∞]``` 中的值
* 若不属于兄弟标签，则首先通过 ```递归``` 找到从根节点到此标签的路径，再对比找到最近相同的公共祖先。通过公式：
 $$ 距离 = 标签1的层级 + 标签2的层级 - 公共祖先层级*2 -1 $$ 
* 举例：第一个标签从自身向上递归到根节点，路径id列表为：``` 7,4,2,1 ```，第二个为 ``` 5,2,1 ```，则可以判定id为2的标签是最近公共祖先
* 若公共祖先不存在，意味着两个标签不属于一个语义中，返回 ``` Two tags have no same parent! ```
  
### 导入标签
* 访问路径为 ``` http://localhost:8080/tags/get?method=importTags&content=car&type=1&parentId=17```
* 接口要求传入标签的 ```content``` 以及类型 ```type ```，可选项为父级标签 ```parentId```。若不选择，视为添加根标签，层级为 ```0```
* ```parentId``` 不存在，返回 ``` Parent is not exist! ```
* ```type ```必须为 ```[0,1,2]``` 中的数字，否则返回 ``` type must be 0、1 or 2 ```
* 若是顶级标签，则直接根据数据插入，返回自增主键id
* 若不是顶级标签，则需要根据 ```父级标签层级 + 1``` 得出自身的层级，然后插入
